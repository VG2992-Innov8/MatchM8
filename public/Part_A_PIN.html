<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Home — MatchM8</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div id="hero" data-page="Home"></div>
  <script src="/hero.js" defer></script>

  <main class="container narrow">
    <div class="home-grid">
      <div class="action">
        <button type="button" class="btn primary" data-target="#nameInput">Login Name</button>
        <div class="input-inline" id="nameInput">
          <input id="playerName" class="input" type="text" placeholder="Enter your name">
        </div>
      </div>

      <div class="action">
        <button type="button" class="btn primary" data-target="#pinInput">Pin</button>
        <div class="input-inline" id="pinInput">
          <input id="playerPin" class="input" type="password" inputmode="numeric" pattern="[0-9]*" placeholder="Enter PIN">
        </div>
      </div>
    </div>

    <div class="action full">
      <button type="button" id="continue" class="btn primary">Continue</button>
    </div>

    <div id="homeBanner" class="banner error" style="display:none;"></div>
  </main>

  <script>
  // Toggle inputs under each button
  document.addEventListener('click', (e) => {
    const btn = e.target.closest('[data-target]');
    if (!btn) return;
    const target = document.querySelector(btn.getAttribute('data-target'));
    if (!target) return;
    const open = target.style.display === 'block';
    target.style.display = open ? 'none' : 'block';
    if (!open) { const i = target.querySelector('input'); if (i) i.focus(); }
  });

  // Continue → (optionally) verify PIN, then go to Predictions

async function verifyAndGo(){
  const name   = (document.getElementById('playerName').value || '').trim();
  const pin    = (document.getElementById('playerPin').value || '').trim();
  const banner = document.getElementById('homeBanner');

  if (!name || !pin){
    banner.textContent = 'Please enter both Login Name and PIN.';
    banner.style.display = 'block';
    setTimeout(()=>banner.style.display='none', 2000);
    return;
  }

  // ✅ Admin shortcut: go straight to Admin page
  if (/^admin$/i.test(name)) {
    // keep your dev flow storage (don’t store real PINs in prod)
    localStorage.setItem('player_name', name);
    localStorage.setItem('player_pin', pin);

    // If the PIN you typed is actually your ADMIN_TOKEN,
    // this pre-fills the token field on Admin (your page already reads ?token=…)
    const maybeToken = pin.length > 8 ? `?token=${encodeURIComponent(pin)}` : '';
    location.href = `/ui/admin.html${maybeToken}`;
    return;
  }

  // Normal user flow → Predictions
  try {
    // optional server verify; ignore failures in dev
    const res = await fetch('/api/auth/pin/verify', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ name, pin })
    });
    if (!res.ok) console.warn('PIN verify not OK, continuing in dev');
  } catch (e) { console.warn('PIN verify failed (dev?)', e); }

  localStorage.setItem('player_name', name);
  localStorage.setItem('player_pin', pin);
  location.href = '/Part_B_Predictions.html';
}
document.getElementById('continue').addEventListener('click', verifyAndGo);
</script>

</body>
</html>
